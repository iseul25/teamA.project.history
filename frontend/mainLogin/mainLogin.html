<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>mainLogin</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="container">
        <header>
            <img src="img/logo1.png" alt="logo">
            <h1>중등 역사 교육</h1>
        </header>
        <div id="bgImg">
            <div id="mainScreen" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                    <li data-target="#myCarousel" data-slide-to="1"></li>
                    <li data-target="#myCarousel" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="item active">
                        <img src="img/bg6.jpg" alt="bg6" style="width: 100%;">
                    </div>
                    <div class="item">
                        <img src="img/bg5.jpg" alt="bg5" style="width: 100%;">
                    </div>
                    <div class="item">
                        <img src="img/bg1.jpg" alt="bg1" style="width: 100%;">
                    </div>
                </div>
                <!-- 슬라이드 버튼 -->
                <a class="left carousel-control" href="#mainScreen" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#mainScreen" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        <div id="box">
            <div id="box1">
                <div id="studyBox">
                    <a href="" style="color: #333;">학습하기</a>
                </div>
                <div id="quizBox">
                    <a href="" onclick="updatePoint('quiz')" style="color: #333;">퀴즈풀기</a>
                </div>
                <div id="attendBox">
                    <a href="" style="color: #333;">출석하기</a>
                </div>
            </div>
            <div id="box2">
                <div id="pointBox">
                    <a href="" style="color: #333;">포인트 상점</a>
                </div>
                <div id="faqBox">
                    <a href="" style="color: #333;">FAQ</a>
                </div>
                <div id="noticeBox">
                    <a href="" style="color: #333;">공지사항</a>
                </div>
            </div>
        </div>
        <!-- <div id="loginBox">
            <h3>Login</h3>
            <div id="inputRow">
                <div id="inputBox">
                    <input type="text" id="id" placeholder="아이디를 입력해 주세요."><br>
                    <input type="text" id="pw" placeholder="비밀번호를 입력해 주세요.">
                </div>
                <div id="btnBox">
                    <button id="lgBox" onclick="login()">로그인</button>
                </div><br>
            </div>
            <button id="suBox" onclick="signUp()">회원가입</button>
        </div> -->
        <div id="welcomeBox" > <!-- none 풀면 화면에 표시 -->
            <img src="img/logo4.jpg" alt="logo4" width="75px">
            <h4 id="welcomeMsg">학생님 안녕하세요!</h4>
            <p id="pointMsg">보유 포인트: 10점</p>
            <div id="mpBox">
                <div id="myPage">
                    <a href="" style="color: #333;">마이페이지</a>
                </div>
                <div id="logout">
                    <a href="" style="color: #333;">로그아웃</a>
                </div>
            </div>
        </div>
        <div id="tel">
            <ul>
                <li>대표전화: 042-222-2402</li>
                <li>주소: (34838) 대전 중구 중앙로121번길 20(방산빌딩 3층)</li>
                <li>운영시간: 평일 09:00 ~ 18:00 (주말·공휴일 휴무)</li>
                <li>© 2025 중등 역사 교육. All rights reserved.</li>
            </ul>
        </div>
    </div>
</body>
<script>
    async function login() {
        const id = document.getElementById("id").value;
        const pw = document.getElementById("pw").value;

        const response = await fetch("http://localhost:3000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id, pw })
        });

        const result = await response.json();
        if (result.success) {
            // 로그인 박스 숨기고 웰컴 박스 표시
            document.getElementById("loginBox").style.display = "none";
            document.getElementById("welcomeBox").style.display = "block";

            // 사용자 이름 표시
            document.getElementById("welcomeMsg").innerText = result.name + "님 안녕하세요!";

            // 사용자 포인트 표시
            document.getElementById("pointMsg").innerText = "보유 포인트: " + result.point + "점";

            // 아이디 저장 (포인트 갱신 때 사용)
            localStorage.setItem("userId", id);
        } else {
            alert(result.message);
        }

        // 포인트 업데이트 함수
        async function updatePoint(activity) {
            const userId = localStorage.getItem("userId");

            const response = await fetch("http://localhost:3000/updatePoint", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id: userId, activity }) // 어떤 활동인지 서버에 전달
            });

            const result = await response.json();
            if (result.success) {
                document.getElementById("pointMsg").innerText =
                    "포인트: " + result.point + "점"; // 최신 포인트 반영
            } else {
                alert("포인트 갱신 실패: " + result.message);
            }
        }
    }
</script>

</html>
