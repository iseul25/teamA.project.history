<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>게시글 수정</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <a href="mainindex.html" class="back-button">메인화면</a>
    <main>
        <a href="index.html" class="list-button">📋 게시글 목록</a>
        <h1>게시글 수정</h1>
        <form id="edit-form">
            <input type="text" id="title" placeholder="제목" required />
            <input type="text" id="author" placeholder="작성자" required />
            <textarea id="content" placeholder="내용" rows="10" required></textarea>
            <input type="text" id="videoUrl" placeholder="YouTube 영상 URL (선택)" />
            <button type="submit">수정 완료</button>
        </form>
    </main>

    <script src="board.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const id = Number(params.get('id'));
        const posts = getPosts();
        const post = posts.find(p => p.id === id);

        if (!post) {
            document.body.innerHTML = '<p>존재하지 않는 글입니다.</p>';
        } else {
            document.getElementById('title').value = post.title;
            document.getElementById('author').value = post.author;
            document.getElementById('content').value = post.content;
            document.getElementById('videoUrl').value = post.videoUrl || '';
        }

        document.getElementById('edit-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const updatedPost = {
                id: post.id, // 기존 id 유지
                title: document.getElementById('title').value.trim(),
                author: document.getElementById('author').value.trim(),
                content: document.getElementById('content').value.trim(),
                date: post.date, // 기존 날짜 유지
                videoUrl: document.getElementById('videoUrl').value.trim(),
                videoId: extractYoutubeId(document.getElementById('videoUrl').value.trim())
            };

            const newPosts = posts.map(p => p.id === post.id ? updatedPost : p);
            localStorage.setItem('posts', JSON.stringify(newPosts));

            alert('수정이 완료되었습니다.');
            window.location.href = `view.html?id=${post.id}`;
        });
    </script>
</body>

</html>