<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ</title>
    <link rel="stylesheet" href="css/faq.css">
    <!-- html과 css를 합치면 link는 주석 처리해 주세요. -->
</head>

<body>
<header>
    <a th:href="@{/}">
        <img th:src="@{/img/mainLg2.png}" alt="메인 로고">
    </a>
    <ul>
        <li><a th:href="@{/board/topic}">학습하기</a></li>
        <li><a th:href="@{/quiz/topic}">퀴즈풀기</a></li>
        <li><a th:href="@{/attend}" onclick="checkLoginAndAttend(event)">출석하기</a></li>
        <li><a th:href="@{/pointStore}">포인트 상점</a></li>
        <li><a th:href="@{/faq}" class="active">FAQ</a></li>
        <li><a th:href="@{/notice}">공지사항</a></li>
    </ul>
    <!-- Thymeleaf로 로그인 상태 처리 -->
    <div id="user" th:if="${session.loginUser != null}">
        <!-- 관리자인 경우 -->
        <a th:if="${session.loginUser.userType == '관리자'}"
           th:href="@{/admin/users}"
           class="userName-link"
           th:text="${session.loginUser.name} + '님'"></a>

        <!-- 일반 사용자인 경우 -->
        <a th:unless="${session.loginUser.userType == '관리자'}"
           th:href="@{/user/myPage}"
           class="userName-link"
           th:text="${session.loginUser.name} + '님'"></a>
    </div>
</header>
<div id="container">
    <div class="faq-container">
        <div class="faq-title">FAQ</div>

        <div class="page-nav">
            <a href="/faq">FAQ</a>
            <p>/</p>
            <a href="/notice">공지사항</a>
        </div>

        <div class="faq-item">
            <div class="faq-question">
                회원가입은 어떻게 하나요?
                <span class="arrow">▼</span>
            </div>
            <div class="faq-answer">
                메인 홈 화면에서 회원가입 버튼을 누르면 회원가입을 할 수 있습니다.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question">
                게시글은 작성할 수 없나요?
                <span class="arrow">▼</span>
            </div>
            <div class="faq-answer">
                게시글은 관리자만 작성할 수 있습니다.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question">
                학습게시물을 봤는데 퀴즈를 풀 수 없어요.
                <span class="arrow">▼</span>
            </div>
            <div class="faq-answer">
                학습게시물 내용 밑에 있는 퀴즈풀기 버튼을 누르셔야 풀 수 있습니다.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question">
                포인트는 어떻게 얻나요?
                <span class="arrow">▼</span>
            </div>
            <div class="faq-answer">
                출석이나 퀴즈풀기를 통해 얻을 수 있습니다.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question">
                학습 내용에 대해 질문을 하려면 어떻게 해야하나요?
                <span class="arrow">▼</span>
            </div>
            <div class="faq-answer">
                게시물 내용 아래 댓글에 남겨주시면 답변 해드리겠습니다.
            </div>
        </div>
    </div>
</div>
<div id="footer">
    <ul>
        <li>대표전화: 042-222-2402</li>
        <li>주소: (34838) 대전 중구 중앙로121번길 20(방산빌딩 3층)</li>
        <li>운영시간: 평일 09:00 ~ 18:00 (주말·공휴일 휴무)</li>
        <li>© 2025 역사 한 걸음. All rights reserved.</li>
    </ul>
</div>
</body>

<script>
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach(item => {
        item.querySelector('.faq-question').addEventListener('click', () => {
            item.classList.toggle('active');
        });
    });

    async function checkLoginAndAttend(e) {
        e.preventDefault(); // 기본 이동 막기

        try {
            const res = await fetch('/api/users/check-login', { credentials: 'include' });
            if (!res.ok) throw new Error('server');

            const data = await res.json();
            // 컨트롤러의 응답 키에 맞춰 사용 (예: data.loggedIn 또는 data.isLoggedIn)
            const isLoggedIn = data.loggedIn ?? data.isLoggedIn ?? data.login === true;

            if (isLoggedIn) {
                window.location.href = '/attend';
                return true;   // 이동 허용(의미상)
            } else {
                alert('로그인 해주세요.');
                // 필요하면 로그인 페이지로 유도
                // window.location.href = '/user/login';
                return false;  // 이동 차단
            }
        } catch (err) {
            alert('로그인 상태 확인 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.');
            return false;
        }
    }
</script>
</html>