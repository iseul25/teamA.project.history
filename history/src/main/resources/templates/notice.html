<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항</title>
    <link rel="stylesheet" href="/css/notice.css">
</head>

<body>
<header>
    <a th:href="@{/}">
        <img th:src="@{/img/mainLg2.png}" alt="메인 로고">
    </a>
    <ul>
        <li><a th:href="@{/board/topic}" class="active">학습하기</a></li>
        <li><a th:href="@{/quiz/topic}">퀴즈풀기</a></li>
        <li><a th:href="@{/attend}">출석하기</a></li>
        <li><a th:href="@{/pointStore}">포인트 상점</a></li>
        <li><a th:href="@{/faq}">FAQ</a></li>
        <li><a th:href="@{/notice}">공지사항</a></li>
    </ul>
    <!-- Thymeleaf로 로그인 상태 처리 -->
    <div id="user" th:if="${session.loginUser != null}">
        <!-- 관리자인 경우 -->
        <a th:if="${session.loginUser.userType == '관리자'}"
           th:href="@{/admin/users}"
           class="userName-link"
           th:text="${session.loginUser.name} + '님'"></a>

        <!-- 일반 사용자인 경우 -->
        <a th:unless="${session.loginUser.userType == '관리자'}"
           th:href="@{/user/myPage}"
           class="userName-link"
           th:text="${session.loginUser.name} + '님'"></a>
    </div>
</header>

<div id="container">
    <div class="notice-container">
        <div class="notice-title">공지사항</div>
        <div class="page-nav">
            <a href="/faq">FAQ</a>
            <p>/</p>
            <a href="/notice">공지사항</a>
        </div>

        <!-- 공지사항 테이블 -->
        <table class="notice-table">
            <thead>
            <tr>
                <th>번호</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일자</th>
            </tr>
            </thead>
            <tbody>
            <!-- Thymeleaf로 서버 데이터 렌더링 -->
            <tr th:each="board, iterStat : ${boards}">
                <!-- 전체 게시글에서 역순으로 번호 매기기 -->
                <td th:text="${totalElements - (currentPage * 10) - iterStat.index}"></td>
                <td>
                    <a th:href="@{/board/detail(boardId=${board.boardId})}" th:text="${board.title}"></a>
                </td>
                <td th:text="${board.name}"></td>
                <td th:text="${#dates.format(board.created, 'yyyy-MM-dd')}"></td>
            </tr>

            <!-- 부족한 만큼 빈 행 추가 -->
            <tr th:each="i : ${#numbers.sequence(1, 10 - (boards != null ? #lists.size(boards) : 0))}" th:if="${boards != null and #lists.size(boards) < 10}">
                <td>&nbsp;</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>

            <!-- 게시글이 아예 없는 경우 -->
            <tr th:if="${boards == null or #lists.isEmpty(boards)}">
                <td colspan="4" style="text-align: center; padding: 50px;">등록된 공지사항이 없습니다.</td>
            </tr>
            </tbody>
        </table>

        <!-- 관리자만 보이는 등록 버튼 -->
        <div th:if="${loginUser != null and loginUser.userType == '관리자'}" style="text-align:right; margin-top:15px;">
            <a th:href="@{/board/create(boardType=공지사항)}" style="text-decoration: none;">
                <button>공지사항 등록</button>
            </a>
        </div>

        <!-- 페이징 영역 - button 스타일 사용 -->
        <div class="pagination" th:if="${totalPages > 0}">
            <!-- 이전 페이지 -->
            <button th:if="${currentPage > 0}"
                    th:onclick="|location.href='/notice?page=${currentPage - 1}'|">◀</button>
            <button th:unless="${currentPage > 0}" disabled>◀</button>

            <!-- 페이지 번호들 -->
            <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <button th:unless="${i == currentPage}"
                        th:onclick="|location.href='/notice?page=${i}'|"
                        th:text="${i + 1}"></button>
                <button th:if="${i == currentPage}"
                        th:text="${i + 1}"
                        class="active"
                        disabled></button>
            </th:block>

            <!-- 다음 페이지 -->
            <button th:if="${currentPage < totalPages - 1}"
                    th:onclick="|location.href='/notice?page=${currentPage + 1}'|">▶</button>
            <button th:unless="${currentPage < totalPages - 1}" disabled>▶</button>
        </div>

        <!-- 페이징이 없는 경우 기본 표시 -->
        <div class="pagination" th:unless="${totalPages > 0}">
            <button disabled>◀</button>
            <button class="active" disabled>1</button>
            <button disabled>▶</button>
        </div>

        <!-- 페이지 정보 표시 -->
        <div th:if="${totalElements > 0}"
             style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;">
        </div>
    </div>
</div>

<div id="footer">
    <ul>
        <li>대표전화: 042-222-2402</li>
        <li>주소: (34838) 대전 중구 중앙로121번길 20(방산빌딩 3층)</li>
        <li>운영시간: 평일 09:00 ~ 18:00 (주말·공휴일 휴무)</li>
        <li>© 2025 역사 한 걸음. All rights reserved.</li>
    </ul>
</div>

</body>
</html>