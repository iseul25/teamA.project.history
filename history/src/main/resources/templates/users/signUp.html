<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="/css/signUp.css">
</head>

<body>
<header>
    <a href="/home">
        <img src="/img/mainLg2.png" alt="ë©”ì¸ ë¡œê³ ">
    </a>
    <ul>
        <li><a href="">í•™ìŠµí•˜ê¸°</a></li>
        <li><a href="">í€´ì¦ˆí’€ê¸°</a></li>
        <li><a href="/attend">ì¶œì„í•˜ê¸°</a></li>
        <li><a href="">í¬ì¸íŠ¸ ìƒì </a></li>
        <li><a href="/faq">FAQ</a></li>
        <li><a href="">ê³µì§€ì‚¬í•­</a></li>
    </ul>
</header>

<div id="container">
    <div id="signUpBox">
        <h1>íšŒ ì› ê°€ ì…</h1>

        <!-- Thymeleaf í¼ê³¼ ê°ì²´ ë°”ì¸ë”© -->
        <form th:action="@{/user/add}" th:object="${user}" method="post">
            <div id="userDataBox">
                <p>ID</p>
                <div id="input-wrapper">
                    <input type="text" id="email" th:field="*{email}" placeholder="abc123@gmail.com">
                    <button type="button" id="checkBtn" onclick="checkEmail()">ì¤‘ë³µí™•ì¸</button>
                </div>
                <div id="emailMsg" class="msg"></div>

                <p>PASSWORD</p>
                <div id="pw-wrapper">
                    <input type="password" id="pw" th:field="*{password}" placeholder="*******">
                    <button type="button" id="togglePw" onclick="togglePassword()">ğŸ‘</button>
                </div>
                <div id="pwMsg" class="msg"></div>

                <p>NAME</p>
                <input type="text" id="name" th:field="*{name}" placeholder="í™ê¸¸ë™">
                <div id="nameMsg" class="msg"></div>
            </div>

            <div id="suBtnBox">
                <button id="suBtn" type="submit" onclick="return validateForm()">ê°€ì…í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>

<!-- Thymeleaf ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥ -->
<div th:if="${errorMessage}" th:text="${errorMessage}" class="error-message"></div>

<div id="footer">
    <ul>
        <li>ëŒ€í‘œì „í™”: 042-222-2402</li>
        <li>ì£¼ì†Œ: (34838) ëŒ€ì „ ì¤‘êµ¬ ì¤‘ì•™ë¡œ121ë²ˆê¸¸ 20(ë°©ì‚°ë¹Œë”© 3ì¸µ)</li>
        <li>ìš´ì˜ì‹œê°„: í‰ì¼ 09:00 ~ 18:00 (ì£¼ë§Â·ê³µíœ´ì¼ íœ´ë¬´)</li>
        <li>Â© 2025 ì—­ì‚¬ í•œ ê±¸ìŒ. All rights reserved.</li>
    </ul>
</div>

<script>
    let emailChecked = false;

    // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸° í† ê¸€
    function togglePassword() {
        const pwInput = document.getElementById("pw");
        const toggleBtn = document.getElementById("togglePw");

        if (pwInput.type === "password") {
            pwInput.type = "text";
            toggleBtn.textContent = "ğŸ™ˆ";
        } else {
            pwInput.type = "password";
            toggleBtn.textContent = "ğŸ‘";
        }
    }

    // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
    async function checkEmail() {
        const emailInput = document.getElementById("email");
        const emailMsg = document.getElementById("emailMsg");
        const email = emailInput.value.trim();

        if (!email) {
            emailMsg.textContent = "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            emailMsg.className = "msg error";
            emailInput.classList.add("error-text");
            emailChecked = false; // í•„ìˆ˜: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ false ì„¤ì •
            return;
        }

        // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            emailMsg.textContent = "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.";
            emailMsg.className = "msg error";
            emailInput.classList.add("error-text");
            emailChecked = false; // í•„ìˆ˜: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ false ì„¤ì •
            return;
        }

        try {
            // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ API ìš”ì²­
            const res = await fetch(`/user/check-email?email=${encodeURIComponent(email)}`);
            const data = await res.json();

            if (data.available) {
                emailMsg.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                emailMsg.className = "msg success";
                emailInput.classList.remove("error-text");
                emailChecked = true; // í•„ìˆ˜: ì‚¬ìš© ê°€ëŠ¥í•  ë•Œ trueë¡œ ì„¤ì •
            } else {
                emailMsg.textContent = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                emailMsg.className = "msg error";
                emailInput.classList.add("error-text");
                emailChecked = false; // í•„ìˆ˜: ì‚¬ìš© ì¤‘ì¼ ë•Œ falseë¡œ ì„¤ì •
            }
        } catch (err) {
            console.error("ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ì¤‘ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ:", err);
            emailMsg.textContent = "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
            emailMsg.className = "msg error";
            emailInput.classList.add("error-text");
            emailChecked = false; // í•„ìˆ˜: ì˜¤ë¥˜ ë°œìƒ ì‹œ falseë¡œ ì„¤ì •
        }
    }

    // ì´ë©”ì¼ ì…ë ¥ê°’ ë³€ê²½ ì‹œ ì¤‘ë³µí™•ì¸ ìƒíƒœ ì´ˆê¸°í™”
    document.getElementById("email").addEventListener("input", function() {
        const emailMsg = document.getElementById("emailMsg");
        emailMsg.textContent = "";
        emailMsg.className = "msg";
        this.classList.remove("error-text");
        emailChecked = false; // ì…ë ¥ê°’ì´ ë³€ê²½ë˜ë©´ ìƒíƒœë¥¼ falseë¡œ ì´ˆê¸°í™”
    });

    // í¼ ìœ íš¨ì„± ê²€ì‚¬
    function validateForm() {
        const email = document.getElementById("email").value.trim();
        const pw = document.getElementById("pw").value.trim();
        const name = document.getElementById("name").value.trim();

        const emailMsg = document.getElementById("emailMsg");
        const pwMsg = document.getElementById("pwMsg");
        const nameMsg = document.getElementById("nameMsg");

        // ë©”ì‹œì§€ ì´ˆê¸°í™”
        emailMsg.textContent = "";
        pwMsg.textContent = "";
        nameMsg.textContent = "";

        let isValid = true;

        // ì´ë©”ì¼ ì²´í¬
        if (email === "") {
            emailMsg.textContent = "ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.";
            emailMsg.className = "msg error";
            isValid = false;
        } else if (!emailChecked) {
            emailMsg.textContent = "ì´ë©”ì¼ ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.";
            emailMsg.className = "msg error";
            isValid = false;
        }

        // ë¹„ë°€ë²ˆí˜¸ ì²´í¬
        if (pw === "") {
            pwMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
            pwMsg.className = "msg error";
            isValid = false;
        } else if (pw.length < 6) {
            pwMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
            pwMsg.className = "msg error";
            isValid = false;
        }

        // ì´ë¦„ ì²´í¬
        if (name === "") {
            nameMsg.textContent = "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.";
            nameMsg.className = "msg error";
            isValid = false;
        }

        return isValid;
    }

    // ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬ (ì„ íƒì )
    document.getElementById("pw").addEventListener("input", function() {
        const pwMsg = document.getElementById("pwMsg");
        if (this.value.length > 0 && this.value.length < 6) {
            pwMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
            pwMsg.className = "msg error";
        } else {
            pwMsg.textContent = "";
            pwMsg.className = "msg";
        }
    });

    document.getElementById("name").addEventListener("input", function() {
        const nameMsg = document.getElementById("nameMsg");
        if (this.value.trim() === "") {
            nameMsg.textContent = "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.";
            nameMsg.className = "msg error";
        } else {
            nameMsg.textContent = "";
            nameMsg.className = "msg";
        }
    });
</script>
</body>
</html>